<!DOCTYPE html>
<html>
<head>
    <style>
        #previewContainer {
            width: 720px;
            height: 1280px;
            position: relative;
            background-size: cover;
            background-position: center;
        }
        #spriteImage {
    width: 182px;
    position: absolute;
    top: 255px;
    left: 185px;
}
       #messageBox {
    width: 201px;
    height: 176px;
    position: absolute;
    top: 450px;
    left: 5px;
    background-color: black;
    color: white;
    padding: 10px;
    box-sizing: border-box;
    overflow: hidden;
    font-size: 35px;
    font-family: sans-serif;
    text-align: center;
}
    </style>
    <title>Game Data Editor</title>
    <script>
        const apiURL = 'https://u8der8ty5g.execute-api.us-east-1.amazonaws.com/dev/ReadWriteDDB';
        const tableName = 'UpdateLive'; // Add your DynamoDB table name here

        async function loadData() {
    try {
        const response = await fetch(`${apiURL}?TableName=${tableName}`);
        const jsonResponse = await response.json();

        if (jsonResponse && jsonResponse.Items && jsonResponse.Items.length > 0) {
            // Sort the items by updateId in descending order
            jsonResponse.Items.sort((a, b) => b.updateId.localeCompare(a.updateId));

            // Now the first item is the most recent one
            const item = jsonResponse.Items[0];
            document.getElementById('promptInput').value = item.prompt || '';
            document.getElementById('audienceMessageInput').value = item.audienceMessage || '';
            document.getElementById('spriteLinkInput').value = item.spriteLink || '';
            document.getElementById('bgLinkInput').value = item.bgLink || '';
            updatePreview(item.bgLink || '', item.spriteLink || '', item.audienceMessage || '');
        } else {
            console.log('No items returned from the database.');
            // Clear all fields
            document.getElementById('promptInput').value = '';
            document.getElementById('audienceMessageInput').value = '';
            document.getElementById('spriteLinkInput').value = '';
            document.getElementById('bgLinkInput').value = ''; // New field
        }
    } catch (error) {
        console.error('Error loading data:', error);
    }
}
async function updateData() {
    try {
        const updateId = `update-${new Date().toISOString()}`;
        const newData = {
            TableName: 'UpdateLive',
            Item: {
                updateId: updateId,
                prompt: document.getElementById('promptInput').value,
                audienceMessage: document.getElementById('audienceMessageInput').value,
                spriteLink: document.getElementById('spriteLinkInput').value,
                bgLink: document.getElementById('bgLinkInput').value // New field
            }
        };

        await fetch(apiURL, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(newData)
        });

        alert('Data updated successfully');
        loadData(); // Reload data after update
    } catch (error) {
        console.error('Error updating data:', error);
    }
}

       document.addEventListener('DOMContentLoaded', (event) => {
        loadData();
           const bgLink = document.getElementById('bgLinkInput').value;
    const spriteLink = document.getElementById('spriteLinkInput').value;
    const audienceMessage = document.getElementById('audienceMessageInput').value;
    updatePreview(bgLink, spriteLink, audienceMessage);
    });
        function updatePreview(bgLink, spriteLink, audienceMessage) {
            const previewContainer = document.getElementById('previewContainer');
            const spriteImage = document.getElementById('spriteImage');
            const messageBox = document.getElementById('messageBox');

            previewContainer.style.backgroundImage = `url('${bgLink}')`;
            spriteImage.src = spriteLink;
            messageBox.textContent = audienceMessage;
        }
    </script>
</head>
<body>
    <h1>Game Data Editor</h1>
    <p>version 1.8</p>
    <div>
        <label for="promptInput">Prompt:</label><br>
        <input type="text" id="promptInput" name="prompt"><br>

        <label for="audienceMessageInput">Audience Message:</label><br>
        <input type="text" id="audienceMessageInput" name="audienceMessage"><br>

        <label for="spriteLinkInput">Sprite Link:</label><br>
        <input type="text" id="spriteLinkInput" name="spriteLink"><br><br>
        <label for="bgLinkInput">Background Link:</label><br>
        <input type="text" id="bgLinkInput" name="bgLink"><br><br>

        <button onclick="updateData()">Update Game Data</button>
        <br><br>
        <p>Preview</p><br>
        <div id="previewContainer">
        <img id="spriteImage" src="" alt="Sprite Image">
        <div id="messageBox"></div>
    </div>
    </div>
</body>
</html>
